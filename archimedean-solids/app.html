<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Archimedean solids</title>
  <link rel="stylesheet" href="../common/css/default.css" media="screen" type="text/css">
  <script type="text/javascript" src="../common/js/Cindy.js"></script>
  <script type="text/javascript" src="../common/js/i18n4js-1.3.0.min.js"></script>
</head>
<body>
<script id='csmousedrag' type='cindyscript'>
        if((mover()!=B) & (mover()!=E),
           wxo2=wxo1;
           wyo2=wyo1;
           wxo1=wx;
           wyo1=wy;
        xx=mouse().x;
yy=mouse().y;
 wy=(startx-xx)*.3;
 wx=-(starty-yy)*.3;

mmmx=[
  [1,0,0],
  [0,cos(wx),sin(wx)],
  [0,-sin(wx),cos(wx)]
];


mmmy=[
  [cos(wy),0,-sin(wy)],
  [0,1,0],
  [sin(wy),0,cos(wy)]
];



  mat=mmmx*mmmy*mat;

          startx=mouse().x;
starty=mouse().y;

);
        </script>

<script id='csmouseup' type='cindyscript'>
            if(|(wxo2,wyo2)|>=0.01,
               wx=wxo2;
               wy=wyo2;
               playanimation(),
               pauseanimation();stopanimation();
               )
               ;



        if(|presspos-mouse().xy|<0.5,


        xx=mouse().x;
yy=mouse().y;
 wy=(startx-xx)*.3;
 wx=-(starty-yy)*.3;

mmmx=[
  [1,0,0],
  [0,cos(wx),sin(wx)],
  [0,-sin(wx),cos(wx)]
];


mmmy=[
  [cos(wy),0,-sin(wy)],
  [0,1,0],
  [sin(wy),0,cos(wy)]
];



  mat=mmmx*mmmy*mat;

 ww )
        </script>

<script id='csmousedown' type='cindyscript'>
            presspos=mouse().xy;

if(|spos0-mouse().xy|<1.5,setstate(0));
if(|spos1-mouse().xy|<1.5,setstate(1));
if(|spos2-mouse().xy|<1.5,setstate(2));
        startx=mouse().x;
starty=mouse().y;
        </script>




<script id='csinit' type='cindyscript'>

    wxo1=0;
    wyo1=0;
    wxo2=0;
    wyo2=0;
    wx=0;
    wy=0;
 firsttime=true;
 setstate(i):=(
     state=i;
     if(state==0,
        obj=obj1;
        calc();repaint();
     );
     if(state==1,
        obj=obj2;
        calc();repaint();
     );
     if(state==2,
        obj=obj3;
        calc();repaint();
     );

 );
state=1;

spos0=(13+2,9);
spos1=(16.5+2,9);
spos2=(20+2,9);

mat=[
    [1,0,0],
    [0,1,0],
    [0,0,1]
    ];

mat0=[
    [1,0,0],
    [0,1,0],
    [0,0,1]
    ];



mmmx=mat0;
mmmy=mat0;



obj1=((-1,-1,-1),(-1,1,1),(1,-1,1),(1,1,-1))*8;
num=4;





obj2=((1,0,0),(-1,0,0),(0,-1,0),(0,1,0),(0,0,-1),(0,0,1))*12;
num=8;

gg=(1-sqrt(5))/2 ;

obj3=(
      (1,gg,0),
      (1,-gg,0),
      (-1,gg,0),
      (-1,-gg,0),
      (0,1,gg),
      (0,1,-gg),
      (0,-1,gg),
      (0,-1,-gg),
      (gg,0,1),
      (-gg,0,1),
      (gg,0,-1),
      (-gg,0,-1)
      )*8;

      obj=obj2;




ma(p):=[p_1,p_2+2];

pos1=(10,-10,-10);
pos1=pos1/|pos1|;
pos2=(-10,-10,-10);
pos2=pos2/|pos2|;
col1=(1,-10,0);
col2=(0,-10,1);

drawfaceB(f,nn,objc):=(
                  if(area(f_1,f_2,f_3)<0,
                  nn=-nn;
                     col=-(pos1*nn*col1+pos2*nn*col2);
                     col=objc*(pos1*nn+pos2*nn+.8);
                     col=objc*.4;//*(pos1*nn+pos2*nn+.8);
                     ff=f++[f_1];
                    fillpoly(f,color->col,alpha->al);
                     apply(1..(length(ff)-1),

                           draw(ff_#,ff_(#+1),size->2,color->(1,1,1))
                           )
                     )
                  );

drawfaceF(f,nn,objc):=(
                  if(area(f_1,f_2,f_3)>0,
                     col=(pos1*nn*col1+pos2*nn*col2);
                     col=objc*(pos1*nn+pos2*nn+.5);
                    // ff=f++[f_1];
                           fillpoly(f,color->col,alpha->al);

                       //    draw(ff_#,ff_(#+1),size->2,color->(0,0,0))

                     )
                  );


drawfaceFEd(f,nn):=(
                  if(area(f_1,f_2,f_3)>0,
                     col=(pos1*nn*col1+pos2*nn*col2);
                     ff=f++[f_1];
                     apply(1..(length(ff)-1),

                           draw(ff_#,ff_(#+1),size->3,color->(1,1,1))
                           )
                     )
                  );

bary(ch):=(

   barfc=[];
   apply(ch_2,fa,
      p1=(ch_1)_(fa_1);
      p2=(ch_1)_(fa_2);
      p3=(ch_1)_(fa_3);
      mid=(p1+p2+p3)/3;
      s12=(p1+p2)/2;
      s23=(p2+p3)/2;
      s31=(p1+p3)/2;
      barfc=barfc++[[p1,s12,mid]];
      barfc=barfc++[[p2,s12,mid]];
      barfc=barfc++[[p2,s23,mid]];
      barfc=barfc++[[p3,s23,mid]];
      barfc=barfc++[[p3,s31,mid]];
      barfc=barfc++[[p1,s31,mid]];

   );
   barfc;

);

calc():=(
         err(obj);

ch=convexhull3d(obj);



bar=bary(ch);

);

calc();
javascript("loaded()");

        </script>




<script id='csdraw' type='cindyscript'>
if(E.x<=C.x,E.xy=C.xy);
if(E.x>=D.x,E.xy=D.xy);
fillcircle((0,0),100,color->(0,0,0));
al=|C,E|/|C,D|+0.001;
PA=(13+2,1);
PB=(20+2,1);
PC=(13+2,-6);



B.color=(1,1,1);

repeat(10,

if(B.x<PA.x,B.xy=[PA.x+0.001,B.y]);
if(B.y>PA.y,B.xy=[B.x,PA.y-0.001]);

cc=meet(join(PC,PB),perp(B,join(PC,PB)));
dd=meet(join(PC,PA),perp(B,join(PC,PA)));
ee=meet(join(PB,PA),perp(B,join(PB,PA)));


if(area(B,PB,PC)>0 ,
   B.xy=cc.xy+(-.001,0.001);
   if(B.x<PC.x,B.xy=PC+(0.001,0.002));
   if(B.x>K.x,B.xy=PB+(-0.002,-0.001));
);


);

cc=meet(join(PC,PB),perp(B,join(PC,PB)));
dd=meet(join(PC,PA),perp(B,join(PC,PA)));
ee=meet(join(PB,PA),perp(B,join(PB,PA)));

fillpoly([PA,dd,B,ee],color->(.0,.5,0.0));
fillpoly([PB,ee,B,cc],color->(.5,.0,0.0));
fillpoly([PC,cc,B,dd],color->(.0,.0,0.5));

color((1,1,1)*.6);
draw(PA,PB,size->3);
draw(PC,PA,size->3);
draw(PC,PB,size->3);

draw(B,cc);
draw(B,dd);
draw(B,ee);

l1=cross(PA,PB);
l1=l1/|(l1_1,l1_2)|;
w1=l1*[B.x,B.y,1]/(-7);
//drawtext((13,5),w1);

l1=cross(PB,PC);
l1=l1/|(l1_1,l1_2)|;
w2=l1*[B.x,B.y,1]/(-7)*sqrt(2);
//drawtext((13,4),w2);

l1=cross(PC,PA);
l1=l1/|(l1_1,l1_2)|;
w3=l1*[B.x,B.y,1]/(-7);
//drawtext((13,3),w3);


A.xy=(0,0);
//translate((2,2));

if(or(mover()==B,firsttime),
erg1=apply(bar,b,b_1*w1+b_2*w2+b_3*w3);
   erg1=apply(erg1,#/|#|*8);
if(length(erg>3),firsttime=false;
);
a=convexhull3d(erg1);
);

points=a_1*transpose(mat);
faces=a_2;



apply(faces,f,
      fa=points_f;
      org=(a_1)_f;
      nn=cross( fa_2-fa_1,fa_2-fa_3);
      nn=nn/|nn|;

      mm=cross( org_2-org_1,org_2-org_3);
      mm=mm/|mm|;
      objcol=(.5,.5,1);
      if(length(f)==4,
         objcol=(0.5,1,0.5);
      );
      if(length(f)==6,
         objcol=(1,0.5,0.5);
      );
objcol=objcol*.7;
      erg=apply(fa,p,ma(p));

      drawfaceB(erg,nn,objcol);
      );


apply(faces,f,
      fa=points_f;
      org=(a_1)_f;
      nn=cross( fa_2-fa_1,fa_2-fa_3);
      nn=nn/|nn|;

      mm=cross( org_2-org_1,org_2-org_3);
      mm=mm/|mm|;
      objcol=(.5,.5,1);
      if(length(f)==4,
         objcol=(0.5,1,0.5);
      );
      if(length(f)==6,
         objcol=(1,0.5,0.5);
      );
      objcol=objcol*.7;
      erg=apply(fa,p,ma(p));

      drawfaceF(erg,nn,objcol);
      );
apply(faces,f,
      fa=points_f;
      nn=cross( fa_2-fa_1,fa_2-fa_3);
      nn=nn/|nn|;
      erg=apply(fa,p,ma(p));


      drawfaceFEd(erg,nn);
      );


if(state==0,drawcircle(spos0,1.2,size->if(state==0,5,0.01),color->(1,1,1)));
if(state==1,drawcircle(spos1,1.2,size->if(state==1,5,0.01),color->(1,1,1)));
if(state==2,drawcircle(spos2,1.2,size->if(state==2,5,0.01),color->(1,1,1)));
drawtext(spos0-(.4,.5),3,size->75,color->(1,1,1));
drawtext(spos1-(.4,.5),4,size->75,color->(1,1,1));
drawtext(spos2-(.4,.5),5,size->75,color->(1,1,1));

if(state==1,
drawimage(PA.xy+(-1,1)*.8,"image3",scale->2.5);
drawimage(PB.xy+(1,1)*.8,"image1",scale->2.5);
drawimage(PC.xy+(-1,-1)*.8,"image2",scale->2.5);
);
if(state==0,
drawimage(PA.xy+(-1,1)*.8,"image6",scale->2.5);
drawimage(PB.xy+(1,1)*.8,"image4",scale->2.5);
drawimage(PC.xy+(-1,-1)*.8,"image5",scale->2.5);
);
if(state==2,
drawimage(PA.xy+(-1,1)*.8,"image9",scale->2.5);
drawimage(PB.xy+(1,1)*.8,"image7",scale->2.5);
drawimage(PC.xy+(-1,-1)*.8,"image8",scale->2.5);
);
drawtext(C-(0,1),international("Alpha"),color->(1,1,1),size->40);
drawtext(spos0-(1,2.5),international("Sym"),color->(1,1,1),size->40);
draw(B.xy,color->(1,1,1),size->6);

        </script>


<script id='cstick' type='cindyscript'>
wx=wx*0.998;
 wy=wy*0.998;
if(|(wx,wy)|<0.001,pauseanimation();stopanimation(););

sp=0.8;
mmmx=[
  [1,0,0],
  [0,cos(wx*sp),sin(wx*sp)],
  [0,-sin(wx*sp),cos(wx*sp)]

];


mmmy=[
  [cos(wy*sp),0,-sin(wy*sp)],
  [0,1,0],
  [sin(wy*sp),0,cos(wy*sp)]
];


mat=mmmx*mmmy*mat;
        </script>


<script type="text/javascript">

  var gslp=[
    {name:"A", kind:"P", type:"Free",alpha:0, pos:[-1000,-1000,1],alpha:.001} ,
    {name:"B", kind:"P", type:"Free",alpha:0, pos:[15+2,-3,1],narrow:120},
    {name:"C", kind:"P", type:"Free",alpha:0, pos:[12+2,5],pinned:true},
    {name:"D", kind:"P", type:"Free",alpha:0, pos:[21+2,5],pinned:true},
    {name:"a", kind:"L", type:"Segment",args:["C","D"],alpha:1,color:[1,1,1]},
    {name:"E", kind:"P", type:"PointOnLine",args:["a"],alpha:1,color:[1,1,1],pos:[19,5],narrow:120}

  ];

  var ready = createCindy.waitFor('i18n');
  var translations = {};
  IMAGINARY.i18n.init().then(function(lang){
    translations[lang] = IMAGINARY.i18n.getStrings();
    ready();
  }).catch(function(err){
    console.log("Error loading translation: " + err);
    throw err;
  });

  cdy=createCindy({
    language: IMAGINARY.i18n.getLang(),
    translations: translations,
    ports: [{
      id: "CSCanvas",
      width: 1920,
      height: 1080,
      transform: [{visibleRect: [-6, 12, 20, -9]}],
      background: "rgb(0,0,0)"
    }],
    scripts:"cs*",
    images:{
      image1:"img/image-1.png",
      image2:"img/image-2.png",
      image3:"img/image-3.png",
      image4:"img/image-4.png",
      image5:"img/image-5.png",
      image6:"img/image-6.png",
      image7:"img/image-7.png",
      image8:"img/image-8.png",
      image9:"img/image-9.png"
    },

    transform:[{scale:1.3},{translate:[2,2]}],
    geometry:gslp});

  var loaded=function(){
    if(window.hasOwnProperty('webkit'))
      window.webkit.messageHandlers.interOp.postMessage({loaded:1});
  }

</script>
<canvas  id="CSCanvas"></canvas>
</body>
</html>
