<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Kaleidoskop</title>
  <link rel="stylesheet" href="../common/css/default.css" media="screen" type="text/css">
  <script type="text/javascript" src="../common/js/Cindy.js"></script>
  <script type="text/javascript" src="../common/js/Cindy3D.js"></script>
</head>
<body>
<div class="app">
  <script id="app_cinderella_01_csmouseupX" type="text/x-cindyscript">
if(|mouse().xy,hot1|<3,type=1);
if(|mouse().xy,hot2|<3,type=2);
if(|mouse().xy,hot3|<3,type=3);


forall(1..length(images),
  p=images_#_1;
  if(|p,mouse().xy|<1.6,sel=#)

)






;
</script>
  <script id="app_cinderella_01_csdraw" type="text/x-cindyscript">
restrict(p,mi,ma):=(
  xx=max(min(p.x,ma.x),mi.x);
  yy=max(min(p.y,ma.y),mi.y);
  p.xy=(xx,yy);
);
minpt=(-22,-17);
maxpt=(19,17);
//draw(minpt,maxpt);
//draw(minpt);
//draw(maxpt);
restrict(A,minpt,maxpt);
restrict(B,minpt,maxpt);
restrict(G,minpt,maxpt);
restrict(D,minpt,maxpt);
restrict(E,minpt,maxpt);

bild=images_sel_2;

if(M.x<=C.x,M.xy=C.xy);
if(M.x>=F.x,M.xy=F.xy);
if(L.y<=K.y,L.xy=K.xy);
if(L.y>=H.y,L.xy=H.xy);

alp=|C,M|/|C,F|/2;


aa=complex(A);
bb=complex(B);

if(type==1,
 cc=bb-(bb-aa)*exp(60°*i)*.5;
);


if(type==2,
 cc=bb-(bb-aa)*exp(60°*i)*1;
);


if(type==3,
 cc=bb-(bb-aa)*exp(45°*i)*sqrt(.5);
);




a=gauss(aa);
b=gauss(bb);
c=gauss(cc);


path=(gauss(aa),gauss(bb),gauss(cc));

d=0.1;
dd=(1/(1-2*d));
r(x,a):=max(0,min(1,(x-a-0.5)*dd+0.5));

//plot(r(x,2));

t1=Tr0.matrix;
t2=Tr1.matrix;
t3=Tr2.matrix;

t2=linereflect(join(gauss(aa),gauss(bb)));
t1=linereflect(join(gauss(aa),gauss(cc)));
t3=linereflect(join(gauss(cc),gauss(bb)));


t1=-t1/t1_3_3;
t2=-t2/t2_3_3;
t3=-t3/t3_3_3;

f(p,m):=m*p.homog;
id=((1,0,0),(0,1,0),(0,0,1));

drawimage(D,E,G,bild,alpha->alp);
drawme(m,al):=(
 gsave();
 fill(polygon((f(a,m),f(b,m),f(c,m))),color->(0,0,0));
 clip((f(a,m),f(b,m),f(c,m)));
 drawimage(f(D,m),f(E,m),f(G,m),bild,alpha->al);
 grestore();
 draw(f(a,m),f(b,m),size->3,color->(0,0,0),alpha->al);
 draw(f(b,m),f(c,m),size->3,color->(0,0,0),alpha->al);
 draw(f(a,m),f(c,m),size->3,color->(0,0,0),alpha->al);
);


drawme2(m,al):=(
 gsave();
// fill(polygon((f(A,m),f(B,m),f(F,m))),color->(0,0,0));
 clip((f(a,m),f(b,m),f(c,m)));
 drawimage(f(D,m),f(E,m),f(G,m),bild,alpha->al);
 grestore();
 draw(f(a,m),f(b,m),size->3,color->(0,0,0),alpha->al);
 draw(f(b,m),f(c,m),size->3,color->(0,0,0),alpha->al);
 draw(f(a,m),f(c,m),size->3,color->(0,0,0),alpha->al);
);


l=|K,L|/|K,H|-0.00001;

if(type==1,
 pre=12;
 list=(
  id,
  t1,
  t2,
  t1*t2,
  t1*t2*t1,
  t1*t2*t1*t2,
  t1*t2*t1*t2*t1,
  t1*t2*t1*t2*t1*t2,
  t1*t2*t1*t2*t1*t2*t1,
  t1*t2*t1*t2*t1*t2*t1*t2,
  t1*t2*t1*t2*t1*t2*t1*t2*t1,
  t1*t2*t1*t2*t1*t2*t1*t2*t1*t2);



  n=l*(12*12)/12+1;

  al=r(n,1);
  list=list
         ++apply(list,#*(-r(n,2)*t3+(1-r(n,2))*id))
         ++apply(list,#*t3*(-r(n,3)*t2+(1-r(n,3))*id))
         ++apply(list,#*t3*t2*(-r(n,4)*t1+(1-r(n,4))*id))
         ++apply(list,#*t3*t2*t1*(-r(n,5)*t2+(1-r(n,5))*id))
         ++apply(list,#*t3*t2*t1*t2*(-r(n,6)*t1+(1-r(n,6))*id))
         ++apply(list,#*t3*t2*t1*t2*t1*(-r(n,7)*t2+(1-r(n,7))*id))
         ++apply(list,#*t3*t2*t1*t2*t1*t2*(-r(n,8)*t3+(1-r(n,8))*id))
         ++apply(list,#*t3*t2*t1*t2*t1*t2*t3*(-r(n,9)*t2+(1-r(n,9))*id))
         ++apply(list,#*t3*t2*t1*t2*(-r(n,10)*t3+(1-r(n,10))*id))
         ++apply(list,#*t3*t2*t1*t2*t3*(-r(n,11)*t1+(1-r(n,11))*id))
         ++apply(list,#*t3*t2*t1*t2*t3*t1*(-r(n,12)*t2+(1-r(n,12))*id));

);



if(type==2,
 pre=6;

 list=(
  id,
  t1,
  t2,
  t1*t2,
  t1*t2*t1,
  t1*t2*t1*t2);



  n=l*(12*12)/12+1;

  al=r(n,1);
  list=list
         ++apply(list,#*(-r(n,2)*t3+(1-r(n,2))*id))
         ++apply(list,#*t3*(-r(n,3)*t1+(1-r(n,3))*id))
         ++apply(list,#*t3*(-r(n,4)*t2+(1-r(n,4))*id))
         ++apply(list,#*t3*t1*(-r(n,5)*t2+(1-r(n,5))*id))
         ++apply(list,#*t3*t2*(-r(n,6)*t1+(1-r(n,6))*id))
         ++apply(list,#*t3*t2*t1*(-r(n,7)*t2+(1-r(n,7))*id))
         ++apply(list,#*t3*t2*t1*(-r(n,8)*t3+(1-r(n,8))*id))
         ++apply(list,#*t3*t2*t1*t3*(-r(n,9)*t2+(1-r(n,9))*id))
         ++apply(list,#*t3*t2*t1*t2*(-r(n,10)*t3+(1-r(n,10))*id))
         ++apply(list,#*t3*t2*t1*t3*t2*(-r(n,11)*t3+(1-r(n,11))*id))
         ++apply(list,#*t3*t1*t2*(-r(n,12)*t3+(1-r(n,12))*id))


);






if(type==3,
 pre=8;

 list=(
  id,
  t1,
  t2,
  t1*t2,
  t1*t2*t1,
  t1*t2*t1*t2,
  t1*t2*t1*t2*t1,
  t1*t2*t1*t2*t1*t2

);



  n=l*(12*12)/12+1;

  al=r(n,1);
  list=list
         ++apply(list,#*(-r(n,2)*t3+(1-r(n,2))*id))
         ++apply(list,#*t3*(-r(n,3)*t2+(1-r(n,3))*id))
         ++apply(list,#*t3*t2*(-r(n,4)*t1+(1-r(n,4))*id))
         ++apply(list,#*t3*t2*(-r(n,5)*t3+(1-r(n,5))*id))
         ++apply(list,#*t3*t2*t1*(-r(n,6)*t2+(1-r(n,6))*id))
         ++apply(list,#*t3*t2*t3*(-r(n,7)*t1+(1-r(n,7))*id))
         ++apply(list,#*t3*t2*t3*t1*(-r(n,8)*t2+(1-r(n,8))*id))
         ++apply(list,#*t3*t2*t3*t1*t2*(-r(n,9)*t1+(1-r(n,9))*id))
         ++apply(list,#*t3*t2*t1*t2*(-r(n,10)*t3+(1-r(n,10))*id))
         ++apply(list,#*t3*t2*t1*t3*t2*(-r(n,11)*t3+(1-r(n,11))*id))
         ++apply(list,#*t3*t2*t1*t3*t2*t3*(-r(n,12)*t1+(1-r(n,12))*id))


);








l=pre*floor(n);
list=apply(1..l,list_#);
nn=length(list);
da(x):=1+x*(x-1)*3.5;


if(nn>12&false,
 forall(1..nn-pre,
  drawme(list_#,al);
 );


 forall(nn-pre+1..nn,
  drawme(list_#,al*da(r(n,floor(n))));
 ),
 forall(1..nn,
  drawme2(list_#,r(n,1));
 );

);


draw(gauss(aa),gauss(bb),size->4,color->(1,1,1));
draw(gauss(aa),gauss(cc),size->4,color->(1,1,1));
draw(gauss(cc),gauss(bb),size->4,color->(1,1,1));


//Grausamer Copy Code, aber ich bin gerade Faul
ty1(p):=(
 al=if(type!=1,.3,1);
 aa=complex(p);
 bb=complex(p+(-4,0));
 cc=bb-(bb-aa)*exp(60°*i)*.5;
 fillpolygon((gauss(aa),gauss(bb),gauss(cc)),color->(0.4,0.6,1)*al);
 draw(gauss(aa),gauss(bb),size->4,color->(1,1,1)*al);
 draw(gauss(aa),gauss(cc),size->4,color->(1,1,1)*al);
 draw(gauss(cc),gauss(bb),size->4,color->(1,1,1)*al);
 hot1=gauss((aa+bb)/2)+(0,2);
);


ty2(p):=(
 al=if(type!=2,.3,1);
 aa=complex(p);
 bb=complex(p+(-4,0));
 cc=bb-(bb-aa)*exp(60°*i);
 fillpolygon((gauss(aa),gauss(bb),gauss(cc)),color->(0.4,0.6,1)*al);
 draw(gauss(aa),gauss(bb),size->4,color->(1,1,1)*al);
 draw(gauss(aa),gauss(cc),size->4,color->(1,1,1)*al);
 draw(gauss(cc),gauss(bb),size->4,color->(1,1,1)*al);
 hot2=gauss((aa+bb)/2)+(0,2);
);

ty3(p):=(
 al=if(type!=3,.3,1);
 aa=complex(p);
 bb=complex(p+(-4,0));
 cc=bb-(bb-aa)*exp(45°*i)*sqrt(0.5);
 fillpolygon((gauss(aa),gauss(bb),gauss(cc)),color->(0.4,0.6,1)*al);
 draw(gauss(aa),gauss(bb),size->4,color->(1,1,1)*al);
 draw(gauss(aa),gauss(cc),size->4,color->(1,1,1)*al);
 draw(gauss(cc),gauss(bb),size->4,color->(1,1,1)*al);
 hot3=gauss((aa+bb)/2)+(0,2);
);






fi(d,a):=(
fill(
polygon(screenbounds())--polygon([
 [-24-d,-21-d],
 [19+d,-21-d],
 [19+d,20+d],
 [-24-d,20+d]
]
),
//COLOR
//color->(2/255,47/255,83/255),
color->(0,0,0),
alpha->a);
);

fi(0,0.2);
fi(0.1,0.2);
fi(0.2,0.2);
fi(0.3,0.2);
fi(0.4,0.2);
fi(0.5,0.2);
fi(0.6,0.2);
fi(0.7,1);

fillpolygon((
  (20,-100),
  (20,100),
  (120,100),
  (120,-100)
),
//COLOR
//color->(2/255,47/255,83/255)
color->(0,0,0)
);


ty1((30,2));
ty2((30,12));
ty3((30,7));


apply(1..4,ind=images_#;
  drawimage(ind_1,ind_2,scale->ind_3*.3,alpha->if(sel==#,1,0.45))
);


;
</script>

  <script id="app_cinderella_01_cstick" type="text/x-cindyscript">

   ttt=0.5;
      D.xy=gauss(complex(D)*exp(.03*i*ttt));
      E.xy=gauss(complex(E)*exp(.03*i*ttt));
      G.xy=gauss(complex(G)*exp(.03*i*ttt));


</script>



  <script id="app_cinderella_01_csmousedown" type="text/x-cindyscript">

li=[hot1,hot2,hot3];
got=sort(1..3,|mouse().xy,li_#|)_1;
if(|mouse().xy,li_got|<4,type=got);

got=sort(1..length(images),|images_#_1,mouse().xy|)_1;
if(|mouse().xy,images_got_1|<4,sel=got);


</script>
  <script id="app_cinderella_01_csinit" type="text/x-cindyscript">
type=1;


sel=1;
images=[
[(28,-4),"bild",.4],
[(28,-8),"bild2",.7],
[(28,-12),"bild3",.5],
[(28,-16),"bild4",.5]
];

pause():=(
   stopanimation();
);


resume():=(
   if(pendanimation,playanimation());
);

reset():=(

A.homog=(4, 0.63313657, -1.04065347);
B.homog=(0.9043478, -4, 0.6749865);
D.homog=(-3.2947, -4, 0.289674);
E.homog=(4, -1.4651206, 0.23502179);
G.homog=(4, -1.81823465, -0.2468792697);
M.homog=(4, 0, 0.13995);
L.homog=(4, -2.09576888, 0.181818);
pendanimation=true;

type=1;
sel=1;
	);
pendanimation=true;

  playanimation();





</script>

  <script type="text/javascript">
    (function(){
      var uid = 'app_cinderella_01_CSCanvas_' + new Date().getTime() + '_' + Math.floor((Math.random() * 100) + 1);
      document.write( "<canvas id=\"" + uid + "\"></canvas>" );

      var cdy01 = createCindy({
        scripts: "app_cinderella_01_cs*",
        defaultAppearance: {},
        images: {
          bild: "img/bild.png",
          bild2: "img/bild2.png",
          bild3: "img/bild3.png",
          bild4: "img/bild4.png",
          bild4X: "img/bild4X.png",
          bildX: "img/bildX.png"
        },
        ports: [{
          id: uid,
          background: "rgba(0,0,0,0)",
          transform: [{visibleRect: [-24.77777777777778, 20.944444444444443, 32.111111111111114, -21.72222222222222]}],
          fill: "window"
        }],
        geometry: [
          {name: "D", type: "Free", pos: [-3.294761077446647, -4, 0.28967492528689526], color: [0, 1, 0]},
          {name: "E", type: "Free", pos: [4, -1.4651206020708303, 0.23502179355544858], color: [0, 1, 0]},
          {name: "G", type: "Free", pos: [4, -1.8182346561184846, -0.2468792697603344], color: [0, 1, 0]},
          {name: "A", type: "Free", pos: [4, 0.6331361369740157, -1.0406676910965347], color: [1, 1, 1]},
          {name: "B", type: "Free", pos: [0.9043478260869564, -4, 0.6749865807836822], color: [1, 1, 1]},
          {name: "H", type: "Free", pos: [4, 3.1491832864888676, 0.18181818181818182], pinned: true, size: 2, color: [1, 1, 1], visible: false},
          {name: "K", type: "Free", pos: [4, -3.1491832864888676, 0.18181818181818182], pinned: true, size: 2, color: [1, 1, 1], visible: false},
          {name: "e", type: "Segment", args: ["H", "K"], pos: [-0.1818181818181818, 0, 4], size: 3, color: [1, 1, 1]},
          {name: "L", type: "PointOnLine", args: ["e"], pos: [4, -2.095768880425196, 0.18181818181818185], narrow: 100, size: 7, color: [1, 1, 1]},
          {name: "C", type: "Free", pos: [4, 0, 0.16], pinned: true, color: [1, 0, 0], labeled: true, visible: false},
          {name: "F", type: "Free", pos: [4, 0, 0.12903225806451613], pinned: true, color: [1, 0, 0], labeled: true, visible: false},
          {name: "a", type: "Segment", args: ["C", "F"], pos: [0, -4, 0], size: 3, color: [1, 1, 1]},
          {name: "M", type: "PointOnLine", args: ["a"], pos: [4, 0, 0.13995342517954137], narrow: 100, size: 0, color: [1, 1, 1],pinned:true}
        ]
      });
    })();
  </script>
</div>
</body>
</html>
