<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Doppelpendel</title>
  <link rel="stylesheet" href="../common/css/default.css" media="screen" type="text/css">
  <script type="text/javascript" src="../common/js/Cindy.js"></script>
  <script type="text/javascript" src="../common/js/Cindy3D.js"></script>
  <script type="text/javascript" src="../common/js/i18n4js-1.3.0.min.js"></script>
</head>
<body>
<div class="app-fixedsize">
  <script id="app_cinderella_04_csdraw" type="text/x-cindyscript">
 if(pressed1,
B.pinned=true;
C.pinned=true,
B.pinned=false;
C.pinned=false
 );
restrict(p,mi,ma):=(
  if(!pressed1,
    xx=max(min(p.x,ma.x),mi.x);
    yy=max(min(p.y,ma.y),mi.y);
    p.xy=(xx,yy);
  );
);
minpt=(-11,-20);
maxpt=(31,11.5);
//draw(minpt,maxpt);
//draw(minpt);
//draw(maxpt);
restrict(B,minpt,maxpt);
restrict(C,minpt,maxpt);
restrict(F,minpt,maxpt);
restrict(G,minpt,maxpt);

 Dummy.xy=0;
 fillpoly(button1,color->gray(if(pressed1,.3,.5)));
drawpoly(button1,color->gray(.8),size->4);
fillpoly(button2,color->gray(if(pressed2,.3,.5)));
drawpoly(button2,color->gray(.8),size->4);
drawtext(button1_1+(2,.5),if(pressed1,international("STOP"),international("START")),color->(1,1,1),size->34);
drawtext(button2_1+(2,.5),international("TRACE"),color->(1,1,1),size->34);
draw(F,G, arrow->true,size->7,color->(1,1,1));

if(pressed2,
n=300;
if(l_1!=C.xy,
  l=[C.xy]++l;
);

if(length(l)>n,
l=apply(1..(length(l)-1),l_#);
);

forall(reverse(1..length(l)),
r=exp(-#*.01)*0.4;
fillcircle(l_#,r,alpha->(1-#/n)/1.5,color->(1,1,0));
drawcircle(l_#,r,alpha->(1-#/n)/1.5,color->(0,0,0));
),
l=[];
);


oldb=B.xy;
oldc=C.xy;
;
</script>
  <script id="app_cinderella_04_csmousedown" type="text/x-cindyscript">
mpo=mouse().xy;
if(mpo.x>button1_1_1 & mpo.x<button1_2_1 & mpo.y>button1_1_2 & mpo.y<button1_3_2,
if(pressed1,stopanimation(),playanimation());
pressed1=!pressed1);
if(mpo.x>button2_1_1 & mpo.x<button2_2_1 & mpo.y>button2_1_2 & mpo.y<button2_3_2,pressed2=!pressed2);

;
</script>
  <script id="app_cinderella_04_csinit" type="text/x-cindyscript">
l=[];
button1=[[14+9,7],[20+9,7],[20+9,8.7],[14+9,8.7]];
button2=[[14+9,4],[20+9,4],[20+9,5.7],[14+9,5.7]];
pressed1=false;
pressed2=false;

oldb=B.xy;
oldc=C.xy;





reset():=(

stopanimation();
A.homog=(4, -2.40740, 0.462962);
B.homog=(8, 4, 1);
C.homog=(9, 7, 1);
F.homog=(3.4, -4, -0.5);
G.homog=(4, -2.1882352, -0.588235);
l=[];
pressed1=false;
pressed2=false;
    );

pause():=(
  pauseanimation();
);
resume():=(
  if(pressed1, playanimation(););
);

</script>

  <script type="text/javascript">
    (function(){
      var uid = 'app_cinderella_B3_CSCanvas_' + new Date().getTime() + '_' + Math.floor((Math.random() * 100) + 1);
      document.write( "<canvas id=\"" + uid + "\"></canvas>" );

      var ready = createCindy.waitFor('i18n');
      var translations = {};
      IMAGINARY.i18n.init().then(function(lang){
        translations[lang] = IMAGINARY.i18n.getStrings();
        ready();
      }).catch(function(err){
        console.log("Error loading translation: " + err);
        throw err;
      });

      var cdy04 = createCindy({
        scripts: "app_cinderella_04_cs*",
        defaultAppearance: {},
        ports: [{
          id: uid,
          background: "rgba(0,0,0,0)",
          transform: [{visibleRect: [-11.125, 11.916666666666666, 31.541666666666668, -20.083333333333332]}],
          width: 1560,
          height: 1170
        }],
        geometry: [
          {name: "A", type: "Free", pos: [4, -2.4074074074074074, 0.46296296296296297], pinned: true, color: [1, 1, 1], alpha: 0.8999999761581421},
          {name: "B", type: "Free", pos: [8, 4, 1], narrow: 100, tracedim: 0.46153846153846156, size: 11, textsize: 17, color: [1, 0.5, 0.5], alpha: 0.8999999761581421},
          {name: "a", type: "Segment", args: ["A", "B"], pos: [-0.400381942958006, 0.10398077170054389, 4], lineborder: true, size: 8, color: [0.098039225, 0.61960787, 0.30588236], alpha: 0.8999999761581421},
          {name: "C", type: "Free", pos: [9, 7, 1], narrow: 100, tracelength: 163, size: 11, color: [0.5, 1, 0.5], alpha: 0.8999999761581421},
          {name: "b", type: "Segment", args: ["B", "C"], pos: [-0.6558559754947599, -0.014400127426873377, 4], lineborder: true, size: 8, color: [0.098039225, 0.61960787, 0.30588236], alpha: 0.8999999761581421},
          {name: "F", type: "Free", pos: [3.4, -4, -0.5], narrow: 100, size: 0, color: [1, 0, 0], alpha: 0.8999999761581421},
          {name: "G", type: "Free", pos: [4, -2.1882352941176473, -0.5882352941176471], narrow: 100, size: 0, color: [1, 0, 0], alpha: 0.8999999761581421},
          {name: "c", type: "Segment", args: ["F", "G"], pos: [0.5882352941176472, 0, 4], overlap: 4, size: 3, color: [1, 1, 1]},
          {name: "Dummy", type: "Free", pos: [0, 0.355889724310776, -0.2506265664160401], pinned: false, color: [1, 0, 0], visible: false}
        ],
        behavior: [
          {behavior: {type: "Environment", gravity: 0, deltat: 0.5, accuracy: 60}},
          {name: "B", behavior: {type: "Mass", mass: 1, friction: 0}},
          {name: "C", behavior: {type: "Mass", mass: 0.2, friction: 0}},
          {name: "a", behavior: {type: "Spring", stype: 0, strength: 110}},
          {name: "b", behavior: {type: "Spring", stype: 0, strength: 110}},
          {name: "c", behavior: {type: "Gravity", strength: 0.01}}
        ],
        language: IMAGINARY.i18n.getLang(),
        translations: translations
      });
    })();
  </script>
</div>
</body>
</html>
